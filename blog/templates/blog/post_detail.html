{% extends "blog/base.html"%}
{% block content%}

<!-- Breadcrumb Navigation -->
<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb" data-aos="fade-right">
    <ol class="breadcrumb bg-white p-3 rounded shadow-sm">
        <li class="breadcrumb-item">
            <a href="{% url 'blog-home' %}" class="text-decoration-none">
                <i class="fas fa-home me-1"></i>Blogs
            </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">{{ object.title|truncatewords:5 }}</li>
    </ol>
</nav>   

<!-- Post Detail Article -->
<article class="media content-section d-flex align-items-start" data-aos="fade-up">
  <div class="row w-100 mt-2">
    <!-- Author Info Sidebar -->
    <div class="col-auto d-flex flex-column align-items-center" data-aos="fade-right" data-aos-delay="100">
        <a href="{% url 'user-posts' object.author.username %}" class="position-relative mb-3">
            <img class="rounded-circle article-img animate__animated animate__pulse animate__infinite animate__slow" src="{{ object.author.profile.image.url }}" style="margin-right: 0%;" alt="{{ object.author.username }}">
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success">
                <i class="fas fa-check"></i>
            </span>
        </a>

        <!-- Like Button -->
        {% if user.is_authenticated %}
            {% if object.author != user %}
                <form action="{% url 'like_post' object.pk %}" method="POST">
                    {% csrf_token %}
                    {% if already_liked %}
                    <button type="submit" name="post_id" value="{{ object.id }}" class="btn btn-sm shadow animate__animated animate__heartBeat animate__infinite animate__slow" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 50px; padding: 0.5rem 1rem;">
                        <i class="fas fa-heart me-1"></i>{{object.likes.count}}
                    </button>
                    {% else %}
                    <button type="submit" name="post_id" value="{{ object.id }}" class="btn btn-outline-secondary btn-sm shadow" style="border-radius: 50px; padding: 0.5rem 1rem;">
                        <i class="far fa-heart me-1"></i>{{object.likes.count}}
                    </button>
                    {% endif %}
                </form>
            {% else %}
            <div class="badge bg-light text-dark p-2 shadow-sm" style="border-radius: 50px;">
                <i class="fas fa-heart me-1" style="color: #e74c3c;"></i>{{object.likes.count}}
            </div>
            {% endif %}
        {% else %}
        <div class="badge bg-light text-dark p-2 shadow-sm" style="border-radius: 50px;">
            <i class="far fa-heart me-1"></i>{{object.likes.count}}
        </div>
        {% endif %}
    </div>

    <!-- Main Content -->
    <div class="col" style="padding: 0%;">
        <div class="media-body">
            <!-- Article Metadata -->
            <div class="article-metadata d-flex justify-content-between align-items-center flex-wrap gap-2 p-3 mb-3" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 12px;" data-aos="fade-left" data-aos-delay="100">
                <div>
                    <a class="mr-2 text-decoration-none" href="{% url 'user-posts' object.author.username %}">
                        <i class="fas fa-user-circle me-1"></i><strong>{{ object.author }}</strong>
                    </a>
                    <small class="text-muted d-block d-sm-inline mt-1 mt-sm-0">
                        <i class="fas fa-clock me-1"></i>{{ object.date_posted|date:"F d, Y" }}
                    </small>
                </div>
                {% if object.author == user %}
                <div class="d-flex gap-2">
                    <a href="{% url 'post-update' object.id %}" class="btn btn-sm btn-outline-custom" style="border-radius: 20px;">
                        <i class="fas fa-edit me-1"></i>Update
                    </a>
                    <a href="{% url 'post-delete' object.id %}" class="btn btn-sm shadow" style="background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%); color: white; border: none; border-radius: 20px;">
                        <i class="fas fa-trash me-1"></i>Delete
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Article Title -->
            <h1 class="article-title mb-4 gradient-text" data-aos="fade-up" data-aos-delay="200">
                {{ object.title }}
            </h1>

            <!-- Article Content -->
            <div class="article-content p-4" style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); line-height: 1.8;" data-aos="fade-up" data-aos-delay="300">
                {{ object.content|safe }}
            </div>

            <!-- Login Prompt for Non-authenticated Users -->
            {% if not user.is_authenticated %}
            <div class="border-top pt-4 mt-4 text-center" data-aos="zoom-in" data-aos-delay="400">
                <div class="card border-0 shadow-sm p-4" style="border-radius: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <i class="fas fa-heart fa-3x mb-3"></i>
                    <h5 class="mb-3">Like this post?</h5>
                    <p class="mb-3">Login to show your appreciation and connect with the author</p>
                    <a href="{% url 'login' %}" class="btn btn-light btn-lg px-5" style="border-radius: 50px; font-weight: 600;">
                        <i class="fas fa-sign-in-alt me-2"></i>Login to Like
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- Share Section -->
            <div class="mt-4 p-4 card border-0 shadow-sm" style="border-radius: 12px;" data-aos="fade-up" data-aos-delay="500">
                <h5 class="mb-3">
                    <i class="fas fa-share-alt me-2 text-primary"></i>Share this post
                </h5>
                <div class="d-flex gap-2 flex-wrap">
                    <button class="btn btn-sm shadow-sm" style="background: #1DA1F2; color: white; border-radius: 20px;" onclick="shareOnTwitter()">
                        <i class="fab fa-twitter me-1"></i>Twitter
                    </button>
                    <button class="btn btn-sm shadow-sm" style="background: #4267B2; color: white; border-radius: 20px;" onclick="shareOnFacebook()">
                        <i class="fab fa-facebook me-1"></i>Facebook
                    </button>
                    <button class="btn btn-sm shadow-sm" style="background: #0077B5; color: white; border-radius: 20px;" onclick="shareOnLinkedIn()">
                        <i class="fab fa-linkedin me-1"></i>LinkedIn
                    </button>
                    <button class="btn btn-sm btn-outline-secondary shadow-sm" style="border-radius: 20px;" onclick="copyToClipboard()">
                        <i class="fas fa-copy me-1"></i>Copy Link
                    </button>
                </div>
            </div>

            <!-- Related Actions -->
            <div class="mt-4 d-flex gap-2 justify-content-center flex-wrap" data-aos="fade-up" data-aos-delay="600">
                <a href="{% url 'blog-home' %}" class="btn btn-outline-custom px-4" style="border-radius: 50px;">
                    <i class="fas fa-arrow-left me-2"></i>Back to Blogs
                </a>
                <a href="{% url 'user-posts' object.author.username %}" class="btn btn-custom px-4" style="border-radius: 50px;">
                    <i class="fas fa-user me-2"></i>View Author's Posts
                </a>
            </div>
        </div>
    </div>
  </div>
</article>

<!-- Share Scripts -->
<script>
    const currentUrl = window.location.href;
    const postTitle = "{{ object.title|escapejs }}";

    function shareOnTwitter() {
        window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(currentUrl)}&text=${encodeURIComponent(postTitle)}`, '_blank');
    }

    function shareOnFacebook() {
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentUrl)}`, '_blank');
    }

    function shareOnLinkedIn() {
        window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(currentUrl)}`, '_blank');
    }

    function copyToClipboard() {
        navigator.clipboard.writeText(currentUrl).then(() => {
            alert('Link copied to clipboard!');
        });
    }
</script>

{% endblock content %}