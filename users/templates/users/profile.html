{% extends "blog/base.html"%}
{% load crispy_forms_tags %}
{% block content%}
    <div class="content-section" data-aos="fade-up">
        <!-- Profile Header -->
        <div class="media d-flex flex-column flex-md-row align-items-center mb-4 p-4" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 16px;">
            <div id="image-preview" class="mr-md-3 mb-3 mb-md-0 position-relative" data-aos="zoom-in">
                <img class="rounded-circle account-img animate__animated animate__fadeIn" src="{{ user.profile.image.url }}" alt="{{ user.username }}">
                <div class="position-absolute bottom-0 end-0 bg-success rounded-circle" style="width: 20px; height: 20px; border: 3px solid white;"></div>
            </div>
            <div class="ml-md-3 mt-3 mt-md-0 text-center text-md-start" data-aos="fade-left">
              <h2 class="account-heading ml-3 mb-2">
                <i class="fas fa-user-circle me-2"></i>{{ user.first_name }}
              </h2>
              <p class="text-muted mb-1" style="font-size: 1.1rem;">
                <i class="fas fa-at me-1"></i>{{ user.username }}
              </p>
              <p class="text-secondary mb-0">
                <i class="fas fa-envelope me-1"></i>{{ user.email }}
              </p>
            </div>
        </div>

        <!-- Update Form -->
        <div data-aos="fade-up" data-aos-delay="200">
            <form method="POST" enctype="multipart/form-data">
              {% csrf_token %}
              <fieldset class="form-group">
                  <legend class="border-bottom mb-4 pb-3 d-flex align-items-center gradient-text">
                      <i class="fas fa-edit me-2"></i>Update Info
                  </legend>
                  
                  <!-- Image Upload Section -->
                  <div class="card border-0 shadow-sm mb-4" style="border-radius: 12px;" data-aos="fade-right">
                      <div class="card-body p-4">
                          <h5 class="card-title mb-3">
                              <i class="fas fa-image me-2 text-primary"></i>Profile Picture
                          </h5>
                          {{ pi_form|crispy }}
                          <p class="text-muted mb-0 mt-2">
                              <i class="fas fa-info-circle me-1"></i>Upload and preview your image
                          </p>
                          <div id="preview-info" class="mt-2"></div>
                      </div>
                  </div>
                  
                  <!-- User Info Section -->
                  <div class="card border-0 shadow-sm mb-4" style="border-radius: 12px;" data-aos="fade-left">
                      <div class="card-body p-4">
                          <h5 class="card-title mb-3">
                              <i class="fas fa-user-edit me-2 text-success"></i>Personal Information
                          </h5>
                          {{ u_form|crispy }}
                      </div>
                  </div>
                  
                  <!-- About Section -->
                  <div class="card border-0 shadow-sm mb-4" style="border-radius: 12px;" data-aos="fade-right">
                      <div class="card-body p-4">
                          <h5 class="card-title mb-3">
                              <i class="fas fa-comment-dots me-2 text-info"></i>About You
                          </h5>
                          {{ pa_form.media }}
                          {{ pa_form|crispy }}
                      </div>
                  </div>
                  
              </fieldset>
              
              <!-- Action Buttons -->
              <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mt-4" data-aos="fade-up">
                  <button class="btn btn-custom px-5 py-3 animate__animated animate__pulse animate__infinite animate__slow" type="submit" style="border-radius: 50px; font-weight: 600;">
                      <i class="fas fa-save me-2"></i>Update Profile
                  </button>
                  <a href="{% url 'user-posts' user.username %}" class="btn btn-outline-secondary px-5 py-3" style="border-radius: 50px; font-weight: 600;">
                      <i class="fas fa-times me-2"></i>Cancel
                  </a>
              </div>
            </form>
        </div>

        <!-- Tips Section -->
        <div class="mt-5 p-4 card border-0 shadow-sm" style="border-radius: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;" data-aos="zoom-in" data-aos-delay="400">
            <h5 class="mb-3">
                <i class="fas fa-lightbulb me-2"></i>Profile Tips
            </h5>
            <ul class="list-unstyled mb-0">
                <li class="mb-2"><i class="fas fa-check me-2"></i>Use a clear profile picture for better recognition</li>
                <li class="mb-2"><i class="fas fa-check me-2"></i>Write an engaging "About" section to introduce yourself</li>
                <li class="mb-2"><i class="fas fa-check me-2"></i>Keep your email updated for important notifications</li>
                <li><i class="fas fa-check me-2"></i>Your profile helps others connect with you!</li>
            </ul>
        </div>
    </div>

    <!-- Enhanced Image Preview Script -->
    <script>
        const fileInput = document.querySelector('input[type="file"]');
        if (fileInput) {
            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const previewDiv = document.getElementById('image-preview');
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.alt = 'Preview Image';
                        img.classList.add('rounded-circle', 'account-img', 'animate__animated', 'animate__zoomIn');
                        previewDiv.innerHTML = '';
                        previewDiv.appendChild(img);
                        
                        document.getElementById('preview-info').innerHTML = '<span class="badge bg-success"><i class="fas fa-check me-1"></i>Image preview loaded</span>';
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
        }
    </script>
    
{% endblock content %}